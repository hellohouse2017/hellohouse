<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <title>線上簽署住宿契約 | 你好哇寓所</title>
    <meta name="description" content="你好哇寓所線上住宿契約簽署頁面。">
    <meta name="robots" content="noindex, nofollow"> 

    <meta property="og:url" content="https://你的Vercel網址.vercel.app/signature.html">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/zh_tw.js"></script>

    <style>
        /* =========================================
           [1] 全域變數定義 (與 Index 一致)
           ========================================= */
        :root {
            --c-primary: #1A202C;       
            --c-accent: #C5A065;        
            --c-accent-hover: #A68550;
            --c-bg-body: #F9F9F7;       
            --c-bg-white: #FFFFFF;
            --c-bg-light: #EDF2F7;
            --c-text-gray: #555555; 
            
            --c-line: #06C755;
            --c-youtube: #CC0000;
            --c-alert: #C53030;

            --font-serif: 'Noto Serif TC', serif; 
            --font-sans: 'Noto Sans TC', sans-serif; 

            --shadow-card: 0 10px 30px -5px rgba(0, 0, 0, 0.05);
            --radius-md: 12px;
            --radius-full: 9999px;
            
            /* 簽名頁專用變數 */
            --border-color: #E2E8F0;
            --disabled-bg: #F7FAFC;
        }

        *, *::before, *::after { box-sizing: border-box; }
        
        body {
            margin: 0;
            font-family: var(--font-sans);
            background-color: var(--c-bg-body);
            color: var(--c-primary);
            line-height: 1.8;
            letter-spacing: 0.02em;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        a { text-decoration: none; color: inherit; transition: 0.3s; }
        img { display: block; max-width: 100%; height: auto; }
        ul { list-style: none; padding: 0; margin: 0; }

        /* =========================================
           [2] Navbar (與 Index 完全一致)
           ========================================= */
        .navbar {
            background: rgba(26, 32, 44, 0.95); backdrop-filter: blur(10px);
            height: 70px; width: 100%; position: fixed; top: 0; left: 0; z-index: 9999;
            border-bottom: 1px solid rgba(197, 160, 101, 0.3); box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .nav-container { display: flex; justify-content: space-between; align-items: center; height: 100%; max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .nav-logo { color: var(--c-accent); font-family: var(--font-serif); font-size: 1.5rem; font-weight: 700; letter-spacing: 1px; }
        .nav-menu { display: flex; align-items: center; gap: 20px; margin: 0; padding: 0; list-style: none; }
        .nav-link { color: #fff; font-size: 0.95rem; font-weight: 500; padding: 10px 5px; position: relative; display: flex; align-items: center; gap: 6px; transition: 0.3s; }
        .nav-link::after { content: ''; position: absolute; width: 0; height: 2px; bottom: 5px; left: 0; background-color: var(--c-accent); transition: width 0.3s; }
        .nav-link:hover::after { width: 100%; }
        .nav-link:hover, .nav-link.active { color: var(--c-accent); }
        
        .dropdown { position: relative; }
        .dropdown-menu { position: absolute; top: 100%; left: 50%; transform: translateX(-50%) translateY(10px); background: #fff; width: 200px; list-style: none; padding: 10px 0; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); opacity: 0; visibility: hidden; transition: all 0.3s ease; border-top: 3px solid var(--c-accent); }
        .dropdown:hover .dropdown-menu { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }
        .dropdown-link { display: flex; align-items: center; gap: 10px; padding: 12px 20px; color: var(--c-primary); font-size: 0.9rem; transition: 0.2s; }
        .dropdown-link i { color: var(--c-accent); width: 20px; text-align: center; }
        .dropdown-link:hover { background-color: var(--c-bg-light); color: var(--c-accent); padding-left: 25px; }
        
        .menu-toggle { display: none; cursor: pointer; }
        .bar { display: block; width: 25px; height: 3px; margin: 5px auto; background-color: var(--c-accent); transition: 0.3s; }
        .arrow-icon { font-size: 12px; margin-left: 2px; transition: 0.3s; }
        .nav-item:hover .arrow-icon { transform: rotate(180deg); }

        /* =========================================
           Hero Section (與 Index 結構一致)
           ========================================= */
        .hero { 
            position: relative; height: 45vh; min-height: 350px;
            display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; 
            color: white; background-color: var(--c-primary); overflow: hidden; 
        }
        .hero-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('images/cover.jpg'); 
            background-size: cover; background-position: center; opacity: 0.6; z-index: 1;
        }
        .hero-content { position: relative; z-index: 2; padding: 0 20px; }
        .hero h1 { font-family: var(--font-serif); font-size: 2.5rem; margin-bottom: 10px; font-weight: 700; letter-spacing: 2px; }
        .hero p { font-size: 1.1rem; margin-bottom: 20px; font-weight: 300; opacity: 0.9; letter-spacing: 1px; }
        
        .hero-line-btn {
            display: inline-flex; align-items: center; gap: 10px;
            background-color: transparent; border: 1px solid var(--c-accent); color: var(--c-accent);
            padding: 10px 30px; border-radius: 50px; font-size: 15px; font-weight: bold; letter-spacing: 1px;
            transition: 0.3s;
        }
        .hero-line-btn:hover { background-color: var(--c-accent); color: white; }

        /* =========================================
           [3] 主要內容區 (合約表單 - 專用樣式)
           ========================================= */
        .container { 
            width: 90%; max-width: 900px; margin: 0 auto; padding: 80px 0; 
            flex: 1; /* 撐開高度 */
        }

        #capture-area {
            background-color: var(--c-bg-white); padding: 50px;
            border: 1px solid #E2E8F0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            border-radius: 12px; position: relative;
            border-top: 5px solid var(--c-accent);
        }

        .doc-header { text-align: center; border-bottom: 1px solid #E2E8F0; padding-bottom: 20px; margin-bottom: 30px; }
        .doc-header h2 { margin: 0; font-size: 1.8rem; color: var(--c-primary); font-family: var(--font-serif); }
        .doc-header p { margin: 5px 0 0; font-size: 0.9rem; color: var(--c-accent); letter-spacing: 1px; }

        /* 資料輸入區 */
        .booking-info-wrapper {
            background-color: #FFFBF2; padding: 30px; border-radius: 8px;
            margin-bottom: 40px; border: 1px dashed var(--c-accent);
            transition: all 0.3s ease;
        }
        
        .date-group { text-align: center; margin-bottom: 25px; }
        .date-label { font-size: 1rem; color: var(--c-accent); margin-bottom: 10px; font-weight: bold; display: block; }
        .date-input {
            padding: 12px; border: 1px solid #CBD5E0; border-radius: 4px;
            font-family: var(--font-sans); color: var(--c-primary);
            font-size: 1rem; background: #fff; width: 100%; max-width: 350px; text-align: center; cursor: pointer;
        }

        .user-info-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
            border-top: 1px dashed #E0D0B8; padding-top: 20px;
        }
        .form-group { display: flex; flex-direction: column; text-align: left; }
        .form-label { font-size: 0.9rem; color: var(--c-text-gray); margin-bottom: 8px; font-weight: bold; }
        .form-input {
            padding: 12px; border: 1px solid #CBD5E0; border-radius: 4px;
            font-size: 1rem; background: #fff; transition: 0.3s; font-family: var(--font-sans);
        }
        .form-input:focus { border-color: var(--c-accent); outline: none; box-shadow: 0 0 0 2px rgba(183, 149, 91, 0.2); }
        
        .highlight-error {
            animation: shake 0.5s ease-in-out; border-color: var(--c-alert) !important;
            box-shadow: 0 0 10px rgba(197, 48, 48, 0.2); background-color: #FFF5F5;
        }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* 條款樣式 */
        .section-title { 
            font-size: 1.3rem; font-weight: bold; color: var(--c-primary); 
            margin-bottom: 20px; border-left: 4px solid var(--c-accent); padding-left: 15px; margin-top: 40px; 
        }
        .contract-option { padding: 20px; margin-bottom: 20px; border-radius: 8px; font-size: 0.95rem; text-align: justify; }
        .contract-option.disabled { border: 1px dashed #CBD5E0; background: var(--c-bg-light); color: #A0AEC0; position: relative; }
        .contract-option.disabled::before { content: "本案不適用"; position: absolute; top: -10px; left: 15px; background: #CBD5E0; color: #fff; font-size: 12px; padding: 2px 8px; border-radius: 4px; }
        .contract-option.selected { border: 2px solid var(--c-accent); background: #FFFCF5; color: var(--c-primary); position: relative; }
        .contract-option.selected::before { content: "☑ 雙方合意適用"; position: absolute; top: -12px; left: 15px; background: var(--c-accent); color: white; font-size: 13px; padding: 2px 10px; border-radius: 4px; font-weight: bold; }
        
        .legal-indent { display: block; margin-left: 2em; text-indent: -2em; margin-bottom: 8px; }

        /* 規範樣式 */
        .rules-section { margin-top: 30px; border-top: 3px double #E2E8F0; padding-top: 30px; }
        .rule-block { margin-bottom: 25px; }
        .rule-title { font-size: 1.1rem; font-weight: bold; color: var(--c-primary); margin-bottom: 10px; display: flex; align-items: center; }
        .rule-title i { margin-right: 10px; color: var(--c-accent); }
        .rule-content { font-size: 0.95rem; color: var(--c-text-gray); padding-left: 24px; text-align: justify; }
        .rule-content ul { margin: 5px 0; padding-left: 18px; }
        .rule-content li { margin-bottom: 8px; }
        .price { color: var(--c-alert); font-weight: bold; font-family: monospace; background: rgba(197, 48, 48, 0.1); padding: 0 4px; border-radius: 2px;}

        /* 簽名區 */
        .signature-wrapper { margin: 40px 0 20px 0; padding: 30px; background: #EDF2F7; border-radius: 12px; text-align: center; border: 1px solid #CBD5E0; }
        .sign-box { width: 100%; max-width: 500px; height: 250px; background: #fff; border: 2px solid #2D3748; margin: 15px auto; position: relative; touch-action: none; border-radius: 4px;}
        canvas { display: block; width: 100%; height: 100%; }
        .sign-hint { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #CBD5E0; font-size: 24px; font-weight: bold; pointer-events: none; }
        .date-stamp { font-family: Consolas, monospace; color: var(--c-primary); font-weight: bold; font-size: 0.9rem; margin-top: 15px; display: block; }
        
        .btn-clear-inline {
            background: transparent; border: none; color: #718096; padding: 5px 10px; font-size: 0.9rem;
            cursor: pointer; transition: 0.3s; display: inline-flex; align-items: center; gap: 5px; margin-top: 10px;
        }
        .btn-clear-inline:hover { color: var(--c-alert); text-decoration: underline; }

        /* 按鈕區 */
        .action-area { margin-top: 50px; text-align: center; padding-bottom: 40px; }
        .download-btn-group { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
        .btn-download-img, .btn-download-pdf {
            border: none; padding: 15px 35px; font-size: 1.1rem; font-weight: bold; 
            border-radius: 50px; cursor: pointer; transition: 0.3s; 
            display: inline-flex; align-items: center; justify-content: center; gap: 10px;
            min-width: 220px;
        }
        .btn-download-img { background: var(--c-accent); color: white; box-shadow: 0 4px 15px rgba(183, 149, 91, 0.3); }
        .btn-download-img:hover { transform: translateY(-3px); background-color: #A68550; }
        .btn-download-pdf { background: var(--c-primary); color: white; box-shadow: 0 4px 15px rgba(45, 55, 72, 0.3); }
        .btn-download-pdf:hover { transform: translateY(-3px); background-color: #000; }
        .generating .fa-spinner { display: inline-block !important; }

        /* =========================================
           Footer (與 Index 完全一致)
           ========================================= */
        .footer { background-color: #2D3748; color: #E2E8F0; padding: 80px 0 40px; border-top: 3px solid var(--c-accent); width: 100%; margin-top: auto; }
        .footer-grid { display: grid; grid-template-columns: 1.5fr 1fr 1fr; gap: 50px; margin-bottom: 50px; max-width: 1100px; margin: 0 auto; padding: 0 20px; }
        .footer h3 { color: var(--c-accent); font-size: 1.1rem; margin-bottom: 25px; font-family: var(--font-serif); }
        .footer-desc { line-height: 1.8; margin-bottom: 20px; text-align: justify; }
        .footer-desc strong { color: #fff; }
        .contact-row { margin-bottom: 15px; display: flex; gap: 10px; }
        .contact-row i { color: var(--c-accent); margin-top: 5px; }
        .seo-tags span { display: inline-block; font-size: 12px; border: 1px solid #4A5568; padding: 4px 10px; border-radius: 4px; margin: 0 5px 8px 0; cursor: default; }
        .copyright { text-align: center; padding-top: 30px; border-top: 1px solid #4A5568; font-size: 0.85rem; color: #A0AEC0; }
        .sticky-btn { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background-color: var(--c-line); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 30px; box-shadow: 0 5px 20px rgba(6,199,85,0.4); z-index: 999; transition: 0.3s; }
        .sticky-btn:hover { transform: scale(1.1); background-color: #05b64d; }

        /* RWD */
        @media (max-width: 960px) {
            .menu-toggle { display: block; }
            .nav-menu { position: fixed; left: -100%; top: 70px; flex-direction: column; background-color: var(--c-primary); width: 100%; height: calc(100vh - 70px); text-align: center; transition: 0.3s; padding-top: 20px; overflow-y: auto; gap: 0; }
            .nav-menu.active { left: 0; }
            .nav-item { width: 100%; border-bottom: 1px solid rgba(255,255,255,0.05); }
            .nav-link { padding: 20px; justify-content: center; font-size: 1.1rem; }
            .nav-link::after { display: none; }
            .dropdown-menu { position: static; opacity: 1; visibility: visible; transform: none; width: 100%; background-color: rgba(0,0,0,0.2); box-shadow: none; border-top: none; display: none; }
            .dropdown.active .dropdown-menu { display: block; }
            .dropdown-link { color: #ccc; padding: 15px; justify-content: center;}
            .user-info-grid { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .footer-grid { grid-template-columns: 1fr; gap: 40px; }
            .section-padding { padding: 60px 0; }
            #capture-area { padding: 30px 20px; }
            .download-btn-group { flex-direction: column; align-items: center; }
        }
        .fade-in { opacity: 0; transform: translateY(20px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; }
        .fade-in.visible { opacity: 1; transform: translateY(0); }

        /* 結果視窗 */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; align-items: center; justify-content: center; flex-direction: column; }
        .result-box { background: #fff; padding: 20px; border-radius: 10px; max-width: 90%; max-height: 90vh; overflow-y: auto; text-align: center; position: relative; }
        .result-img { width: 100%; border: 1px solid #ddd; margin-bottom: 15px; }
        .btn-close { position: absolute; top: 10px; right: 10px; background: #eee; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-weight: bold; }
        .tip-text { color: #2F855A; font-weight: bold; margin-bottom: 10px; font-size: 14px; background: #F0FFF4; padding: 10px; border-radius: 6px; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">你好哇寓所</a>
            <div class="menu-toggle" id="mobile-menu">
                <span class="bar"></span><span class="bar"></span><span class="bar"></span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link"><i class="fa-solid fa-house"></i> 首頁</a>
                </li>
                <li class="nav-item">
                    <a href="rooms.html" class="nav-link"><i class="fa-solid fa-bed"></i> 房型介紹</a>
                </li>
                
                <li class="nav-item dropdown">
                    <a href="agreement.html" class="nav-link dropdown-toggle active">
                        <i class="fa-solid fa-file-signature"></i> 入住契約 <i class="fa-solid fa-angle-down arrow-icon"></i>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="signature.html" class="dropdown-link"><i class="fa-solid fa-pen-nib"></i> 線上簽約</a></li>
                        <li><a href="agreement.html" class="dropdown-link"><i class="fa-regular fa-file-pdf"></i> 契約條款預覽</a></li>
                    </ul>
                </li>

                <li class="nav-item">
                    <a href="traffic.html" class="nav-link"><i class="fa-solid fa-car"></i> 交通停車</a>
                </li>
                
                <li class="nav-item dropdown">
                    <a href="travel.html" class="nav-link dropdown-toggle">
                        <i class="fa-solid fa-map-location-dot"></i> 旅遊行程 <i class="fa-solid fa-angle-down arrow-icon"></i>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="food.html" class="dropdown-link"><i class="fa-solid fa-bowl-food"></i> 鹽埕美食地圖</a></li>
                        <li><a href="attractions.html" class="dropdown-link"><i class="fa-solid fa-camera"></i> 周邊景點導覽</a></li>
                    </ul>
                </li>
                
                <li class="nav-item dropdown">
                    <a href="javascript:void(0)" class="nav-link dropdown-toggle" style="color:var(--c-accent);">
                        <i class="fa-solid fa-bullhorn"></i> 住宿情報 <i class="fa-solid fa-angle-down arrow-icon"></i>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="packages.html" class="dropdown-link"><i class="fa-solid fa-building"></i> 企業包棟方案</a></li>
                        <li><a href="packages.html" class="dropdown-link"><i class="fa-solid fa-heart"></i> 迎娶包棟方案</a></li>
                        <li><a href="packages.html" class="dropdown-link"><i class="fa-solid fa-users"></i> 家族包棟方案</a></li>
                        <li><a href="packages.html" class="dropdown-link"><i class="fa-solid fa-basketball"></i> 球隊比賽方案</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </nav>

    <a href="https://lin.ee/atCiMQw" target="_blank" class="sticky-btn" aria-label="Line 訂房">
        <i class="fa-brands fa-line"></i>
    </a>

    <header class="hero">
        <div class="hero-bg"></div>
        <div class="hero-content fade-in">
            <h1>住宿契約簽署</h1>
            <p>ONLINE SIGNATURE</p>
            <a href="index.html" class="hero-line-btn">
                <i class="fa-solid fa-house"></i> 返回首頁
            </a>
        </div>
    </header>

    <div class="container">
        
        <div id="capture-area">
            <div class="doc-header">
                <h2>住宿契約與規範</h2>
                <p>Accommodation Contract</p>
            </div>

            <div id="booking-info" class="booking-info-wrapper">
                <div class="date-group">
                    <span class="date-label"><i class="fa-regular fa-calendar-check"></i> 請選擇入住與退房日期</span>
                    <input type="text" id="date-range-picker" class="date-input" placeholder="點擊選擇日期範圍..." readonly>
                </div>
                
                <div class="user-info-grid">
                    <div class="form-group">
                        <label class="form-label" for="booker-name">訂房人姓名 (Name)</label>
                        <input type="text" id="booker-name" class="form-input" placeholder="請輸入真實姓名">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="booker-phone">聯絡電話 (Phone)</label>
                        <input type="tel" id="booker-phone" class="form-input" placeholder="09xxxxxxxx (限台灣手機)">
                    </div>
                </div>
            </div>

            <div class="legal-section">
                <div class="section-title">一、定型化契約條款</div>
                <p style="font-size:0.95rem; margin-bottom:20px; color:#666;">旅客訂房一律按「行政院旅宿定型化契約條款」預收約定房價總金額，旅客解除契約時可依下列方式之處理（預收約定房價總金額者，依下列方式之一處理）：</p>

                <div class="contract-option disabled">
                    <strong>□ 比例退還預收約定房價總金額 (本案不適用)：</strong>
                    <div class="legal-text-content">
                        <span class="legal-indent">(一)旅客解約通知於預定住宿日前第三日以前到達者，業者應退還預收約定房價總金額百分之百。</span>
                        <span class="legal-indent">(二)旅客解約通知於預定住宿日前第一日至第二日到達者，業者應退還預收約定房價總金額百分之五十。</span>
                        <span class="legal-indent">(三)旅客解約通知於預定住宿日當日到達或未為解約通知者，業者得不退還預收約定房價總金額。</span>
                    </div>
                </div>

                <div class="contract-option selected">
                    <strong>□ 一年內保留已付金額作為日後消費折抵使用：</strong>
                    <div class="legal-text-content">
                        <span class="legal-indent">(一)旅客解約通知於預定住宿日當日前到達者，得於一年內保留已付金額作為日後消費折抵使用。</span>
                        <span class="legal-indent">(二)旅客解約通知於預定住宿日當日到達或未為解約通知者，業者得不退還預收約定房價總金額。</span>
                    </div>
                    <div style="margin-top:10px; border-top:1px dashed #B7955B; padding-top:10px; font-size:0.9rem; color:#888;">
                        * 特別約定：旅客同意以優惠價格預訂，雙方合意僅依此條款作為解約處理方式。
                    </div>
                </div>
            </div>

            <div class="rules-section">
                <div class="section-title">二、住宿生活公約</div>
                
                <div class="rule-block">
                    <div class="rule-title"><i class="fa-solid fa-users"></i> 訂房與押金須知</div>
                    <div class="rule-content">
                        <ul>
                            <li>請依實際訂房人數入住，超出預定人數入住部分加收每人 <span class="price">1,800元/日</span>，如需要加人(床)，請於入住前一日告知，並加收超出預定人數每人 <span class="price">1,000元/日</span>（假日或連續假期為每人 <span class="price">1,500元/日</span>）。</li>
                            <li><strong>押金規定：</strong>為確保雙方權益，辦理入住時需收取押金 <span class="price">5,000元</span>。於退房後確認無任何設備損壞，且未違反入住須知（含過於髒亂）後全數匯款退還。</li>
                        </ul>
                    </div>
                </div>

                <div class="rule-block">
                    <div class="rule-title"><i class="fa-solid fa-clock"></i> 進退房時間</div>
                    <div class="rule-content">
                        <ul>
                            <li>進房時間：入住當日 <strong>16:00PM</strong> 以後。(若情況允許，可經由民宿主人同意後提早入住。入住時請出示身分證或護照辦理住宿登記，並當場繳清餘款。最晚請於入住當日 21:00PM 前完成Check-in入住手續)</li>
                            <li>退房時間：退房當日 <strong>11:00AM</strong> 以前。</li>
                            <li>未經民宿主人同意延遲退房，一小時加收 <span class="price">1,500元</span>，超過五小時以一日包棟定價 <span class="price">(34,800)</span> 計算。</li>
                        </ul>
                    </div>
                </div>

                <div class="rule-block">
                    <div class="rule-title" style="color:var(--c-alert);"><i class="fa-solid fa-ban"></i> 禁止行為</div>
                    <div class="rule-content">
                        <ul>
                            <li>本民宿全棟禁止「吸菸」、「吸毒」、「賭博」、「嚼檳榔」、「燃放爆竹」及任何違反善良風俗之不法行為。如有抽菸需求請至一樓戶外區。若有違法行為將直接報警處理不另行通知。</li>
                            <li>本旅宿<strong>非寵物友善旅宿</strong>，切勿攜帶寵物入住，以維護旅客權益（事前詢問且經業主同意*不接受入住當天詢問*攜帶寵物入住者，酌收清潔費 <span class="price">$800元/平日、$1000元/假日</span>，且造成損壞仍需照價賠償）。</li>
                            <li>除當日入住房客之外，恕不對外開放參觀，且嚴禁非當日入住房客以外人士進入以維持住宿品質及安全，敬請見諒。</li>
                            <li>包棟開放區域為一樓廚房與所開立之房間外，其餘地方(包含頂樓露台與通往頂樓之樓梯間)為屋主私人空間，未經同意嚴禁人員進入，若經發現將逕行依法(刑法306條)處理。</li>
                        </ul>
                    </div>
                </div>

                <div class="rule-block">
                    <div class="rule-title"><i class="fa-solid fa-sink"></i> 備品與維護</div>
                    <div class="rule-content">
                        <ul>
                            <li>民宿不主動提供更換枕套、床單、浴巾等備品，如需付費更換請主動告知。</li>
                            <li>連續入住之房客，原則上提供每3日更換一次浴巾之免費服務，為顧及房客隱私，需更換浴巾之房客請將使用過之浴巾統一集中於一樓公共空間，替換之乾淨浴巾也會統一放置於一樓公共空間。（例如：1號入住３號中午更換）</li>
                            <li>開放式客廳之微波爐、熱水壺、冰箱、電視、餐具、娛樂設施於入住期間免費提供房客使用，惟使用後請恢復原貌及妥善清潔，並請隨手關燈、冷氣及節約用水，未遵守者視情況扣除押金。</li>
                        </ul>
                    </div>
                </div>

                <div class="rule-block">
                    <div class="rule-title"><i class="fa-solid fa-triangle-exclamation"></i> 安全、安寧與賠償</div>
                    <div class="rule-content">
                        <ul>
                            <li><strong>安寧時間：</strong>民宿位於住宅區，為維護社區他人安寧，入住房客請於每日 <span class="price">23:00至隔日08:00</span> 期間降低音量，民宿內外勿大聲喧嘩、咆哮，若經屢勸無效則要求立即退房，恕無退還房費，不便之處請見諒！</li>
                            <li><strong>財物安全：</strong>包棟期間，民宿主人或管家仍保留公共空間進出與維護管理之權利。房客外出時，請鎖上房門，貴重物品請隨身攜帶小心保管，如有遺失不予理賠。民宿所屬之物品僅提供旅客住宿期間使用，請勿私自攜出帶離，如有損壞或遺失，將依市價賠償。</li>
                            <li><strong>安全注意：</strong>民宿內有階梯、欄杆、窗戶等等設施，請注意同行幼童及長者安全，互相約束不得在室外與室內有追逐、尖叫、攀爬、打球、使用遙控飛機或任何具有危險因子之遊戲或行為。</li>
                            <li><strong>賠償價目表：</strong><br>
                                - 寢具用品沾上血漬、嘔吐物、排泄物、紅酒漬、染色等狀況，將收取特殊清潔費 <span class="price">500～2,000元</span>。<br>
                                - 公共空間使用完畢若未妥善復原，將視情況收取額外清潔費用 <span class="price">500～5,000元</span>。<br>
                                - 若發現室內吸煙行為，<strong>直接扣除全額押金 <span class="price">5,000元</span> 作為清潔費。</strong><br>
                                *以上情況如經判定無法清潔復原，將另依市價收取賠償費用。
                            </li>
                        </ul>
                    </div>
                </div>
                
                <div style="background:#2D3748; color:#fff; padding:15px; font-size:0.9rem; border-radius:4px; margin-top:10px;">
                    <strong>規範限制聲明：</strong><br>
                    在您訂房的同時，將視同了解並接受上述安全規定與限制，若違反上述限制與規定肇生任何意外，不得對民宿與民宿負責人進行任何之究責與索賠行為。如您無法理解與接受安全規定之必要，與自身負起完全之責任，請另行安排旅程中之住宿選擇。
                </div>
            </div>

            <div class="signature-wrapper">
                <div style="font-weight:bold; margin-bottom:5px; color:#2D3748;">旅客簽名 (Signature)</div>
                <div style="font-size:0.9rem; color:#666;">本人已詳閱並同意上述所有條款</div>
                
                <div class="sign-box" id="sign-wrapper">
                    <span class="sign-hint" id="sign-hint">請在此簽名</span>
                    <canvas id="signature-canvas"></canvas>
                </div>
                
                <button class="btn-clear-inline" onclick="clearPad()">
                    <i class="fa-solid fa-rotate-right"></i> 清除重簽
                </button>
                <div id="date-display" class="date-stamp"></div>
            </div>
        </div>
        <div class="action-area">
            <p style="margin-bottom:15px; font-weight:bold; color:#2D3748;">請完成簽名後，選擇下載方式：</p>
            <div class="download-btn-group">
                <button class="btn-download-img" onclick="handleGenerate('image')">
                    <i class="fa-solid fa-image"></i> 存到手機相簿 (JPG)
                    <i class="fa-solid fa-spinner fa-spin" style="display:none;"></i>
                </button>
                <button class="btn-download-pdf" onclick="handleGenerate('pdf')">
                    <i class="fa-solid fa-file-pdf"></i> 下載合約 (PDF)
                    <i class="fa-solid fa-spinner fa-spin" style="display:none;"></i>
                </button>
            </div>
            <p style="font-size:13px; color:#666; margin-top:15px;">完成後請將檔案傳送給民宿主人確認</p>
        </div>

    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div>
                    <h3>關於 你好哇寓所</h3>
                    <div class="footer-desc">
                        <p>「你好哇・寓所」位於擁有深厚歷史底蘊的<strong>高雄鹽埕區</strong>，是一間保留了<strong>老屋溫度</strong>且<strong>合法</strong>的精緻獨棟民宿。我們擁有絕佳的地理位置，鄰近<strong>捷運鹽埕埔站</strong>，步行至<strong>駁二藝術特區</strong>僅需10分鐘，<strong>大港橋</strong>亦近在咫尺。</p>
                        <p>我們專注於提供 <strong>6~38人</strong> 的彈性<strong>大空間包棟住宿</strong>。館內配置了<strong>大型中島廚房</strong>、寬敞舒適的大客廳與專屬<strong>麻將設備</strong>。無論是溫馨的<strong>家庭旅遊</strong>、熱鬧的<strong>朋友聚會</strong>或是<strong>員工旅遊</strong>，這裡都是您在高雄港都的最佳選擇。</p>
                    </div>
                </div>
                <div>
                    <h3>聯絡資訊</h3>
                    <div class="contact-row">
                        <i class="fa-solid fa-location-dot"></i>
                        <a href="https://goo.gl/maps/qxGN4mpNP8qfRCB16" target="_blank">高雄市鹽埕區大公路70巷8號<br>(近捷運鹽埕埔站 O2)</a>
                    </div>
                    <div class="contact-row">
                        <i class="fa-solid fa-phone"></i>
                        <a href="tel:0932828922">0932-828-922</a>
                    </div>
                    <div class="contact-row">
                        <i class="fa-brands fa-line"></i>
                        <a href="https://lin.ee/atCiMQw" target="_blank">LINE ID: 0932828922</a>
                    </div>
                </div>
                <div>
                    <h3>熱門關鍵字</h3>
                    <div class="seo-tags">
                        <span>高雄包棟推薦</span><span>鹽埕區民宿</span><span>駁二住宿</span>
                        <span>麻將民宿</span><span>中島廚房</span><span>親子住宿</span><span>棧貳庫周邊</span>
                    </div>
                </div>
            </div>
            <div class="copyright">
                © 2025 你好哇寓所 Hello House. All Rights Reserved.
            </div>
        </div>
    </footer>

    <div id="result-modal" class="modal-overlay">
        <div class="result-box">
            <button class="btn-close" onclick="closeModal()">X</button>
            <div class="tip-text"><i class="fa-solid fa-circle-check"></i> 圖片已生成！請長按圖片儲存</div>
            <img id="generated-image" class="result-img" src="" alt="合約圖片">
        </div>
    </div>

    <script>
        let datePicker;
        const { jsPDF } = window.jspdf; 

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 1. 日期選擇器
            datePicker = flatpickr("#date-range-picker", {
                mode: "range",
                minDate: "today",
                dateFormat: "Y-m-d",
                conjunction: " 至 ",
                locale: "zh_tw"
            });

            // 2. Navbar 手機版邏輯
            const mobileMenu = document.getElementById('mobile-menu');
            const navMenu = document.querySelector('.nav-menu');
            if(mobileMenu){
                mobileMenu.addEventListener('click', () => {
                    mobileMenu.classList.toggle('is-active');
                    navMenu.classList.toggle('active');
                });
            }

            document.querySelectorAll('.dropdown').forEach(dropdown => {
                const toggle = dropdown.querySelector('.dropdown-toggle');
                if(toggle) {
                    toggle.addEventListener('click', (e) => {
                        if (window.innerWidth <= 960) {
                            const href = toggle.getAttribute('href');
                            if (href && href !== '#' && href !== 'javascript:void(0)') {
                                return; 
                            }
                            e.preventDefault();
                            dropdown.classList.toggle('active');
                        }
                    });
                }
            });
            
            // 3. 捲動特效
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('visible');
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
        });

        // 4. 簽名板功能
        const canvas = document.getElementById('signature-canvas');
        const ctx = canvas.getContext('2d');
        const wrapper = document.getElementById('sign-wrapper');
        const hint = document.getElementById('sign-hint');
        let isDrawing = false;
        let hasSigned = false;

        function resize() {
            const ratio = Math.max(window.devicePixelRatio || 1, 1);
            canvas.width = wrapper.offsetWidth * ratio;
            canvas.height = wrapper.offsetHeight * ratio;
            ctx.scale(ratio, ratio);
            ctx.strokeStyle = "#000";
            ctx.lineWidth = 2; 
            ctx.lineCap = "round"; 
            ctx.lineJoin = "round";
        }
        window.addEventListener('resize', resize);
        resize();

        function start(e) { isDrawing = true; hasSigned = true; hint.style.display = 'none'; ctx.beginPath(); draw(e); }
        function end() { isDrawing = false; ctx.beginPath(); }
        function draw(e) {
            if(!isDrawing) return;
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            let x, y;
            if(e.type.includes('touch')) {
                x = e.touches[0].clientX - rect.left;
                y = e.touches[0].clientY - rect.top;
            } else {
                x = e.clientX - rect.left;
                y = e.clientY - rect.top;
            }
            ctx.lineTo(x, y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(x, y);
        }

        canvas.addEventListener('mousedown', start);
        canvas.addEventListener('mouseup', end);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('touchstart', start, {passive: false});
        canvas.addEventListener('touchend', end);
        canvas.addEventListener('touchmove', draw, {passive: false});

        function clearPad() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            resize();
            hint.style.display = 'block';
            hasSigned = false;
        }

        // 5. 生成與下載邏輯 (含驗證)
        async function handleGenerate(type) {
            // 取得輸入值
            const name = document.getElementById('booker-name').value.trim();
            const phone = document.getElementById('booker-phone').value.trim();
            
            // 手機號碼正規表達式 (09開頭 + 8碼數字)
            const phoneRegex = /^09\d{8}$/;

            // 驗證
            if (!datePicker || datePicker.selectedDates.length !== 2) {
                scrollToError('booking-info');
                alert("請先選擇「入住與退房日期」！");
                return;
            }
            if (!name) {
                scrollToError('booker-name');
                alert("請輸入訂房人姓名！");
                return;
            }
            if (!phone) {
                scrollToError('booker-phone');
                alert("請輸入聯絡電話！");
                return;
            }
            if (!phoneRegex.test(phone)) {
                scrollToError('booker-phone');
                alert("手機號碼格式錯誤！請輸入 10 碼台灣手機號碼 (如 0912345678)");
                return;
            }
            if (!hasSigned) {
                scrollToError('signature-wrapper');
                alert("請在下方簽名欄完成簽名！");
                return;
            }

            // 更新時間戳記
            const now = new Date();
            const timeStr = `${now.getFullYear()}/${(now.getMonth()+1).toString().padStart(2,'0')}/${now.getDate().toString().padStart(2,'0')} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
            document.getElementById('date-display').innerText = "簽署時間：" + timeStr;

            // 產生檔名：入住日期_姓名_你好哇寓所合約
            const dateRangeValue = document.getElementById('date-range-picker').value;
            const checkInDate = dateRangeValue.split(' 至 ')[0];
            const fileName = `${checkInDate}_${name}_你好哇寓所合約`;

            // 鎖定按鈕狀態
            const btn = (type === 'image') ? document.querySelector('.btn-download-img') : document.querySelector('.btn-download-pdf');
            const originalText = btn.innerHTML;
            const allBtns = document.querySelectorAll('.btn-download-img, .btn-download-pdf');
            
            allBtns.forEach(b => b.disabled = true);
            btn.classList.add('generating');

            try {
                const captureArea = document.getElementById("capture-area");
                const canvas = await html2canvas(captureArea, { scale: 2, useCORS: true, backgroundColor: "#ffffff" });
                
                if (type === 'image') {
                    // 下載圖片
                    const link = document.createElement('a');
                    link.download = fileName + '.jpg';
                    link.href = canvas.toDataURL('image/jpeg', 0.9);
                    link.click();
                    
                } else if (type === 'pdf') {
                    // 下載 PDF
                    const imgData = canvas.toDataURL('image/jpeg', 1.0);
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    const imgProps = pdf.getImageProperties(imgData);
                    const imgHeight = (imgProps.height * pdfWidth) / imgProps.width;
                    
                    // 自適應分頁 (簡單版：長圖模式)
                    if (imgHeight > pdfHeight) {
                         const pdfLong = new jsPDF('p', 'mm', [210, (imgHeight * 210 / pdfWidth) + 20]); 
                         pdfLong.addImage(imgData, 'JPEG', 0, 0, 210, (imgHeight * 210 / pdfWidth));
                         pdfLong.save(fileName + '.pdf');
                    } else {
                        pdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, imgHeight);
                        pdf.save(fileName + '.pdf');
                    }
                }
                
                // 成功後提示
                alert("合約生成成功！請檢查您的下載資料夾。");

            } catch (err) {
                console.error(err);
                alert("生成失敗，請稍後再試或截圖保存。");
            } finally {
                allBtns.forEach(b => b.disabled = false);
                btn.classList.remove('generating');
                btn.innerHTML = originalText;
            }
        }

        // 輔助：捲動到錯誤欄位並高亮
        function scrollToError(elementId) {
            const el = document.getElementById(elementId).closest('div') || document.getElementById(elementId);
            if(elementId === 'booking-info') {
                document.getElementById('booking-info').classList.add('highlight-error');
                setTimeout(() => document.getElementById('booking-info').classList.remove('highlight-error'), 1000);
            } else if (elementId === 'signature-wrapper') {
                document.querySelector('.signature-wrapper').classList.add('highlight-error');
                setTimeout(() => document.querySelector('.signature-wrapper').classList.remove('highlight-error'), 1000);
            } else {
                document.getElementById(elementId).classList.add('highlight-error');
                setTimeout(() => document.getElementById(elementId).classList.remove('highlight-error'), 1000);
            }
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function closeModal() {
            document.getElementById('result-modal').style.display = 'none';
        }
    </script>

</body>
</html>