<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ç·šä¸Šç°½ç½²ä½å®¿å¥‘ç´„ | ä½ å¥½å“‡å¯“æ‰€</title>
    <meta name="robots" content="noindex, nofollow"> 

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/zh_tw.js"></script>
    
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

    <style>
        /* =========================================
           Design System
           ========================================= */
        :root {
            --c-primary: #1A202C;       
            --c-accent: #C5A065;        
            --c-accent-hover: #A68550;
            --c-bg-body: #F9F9F7;       
            --c-bg-white: #FFFFFF;
            --c-text-gray: #555555; 
            --c-line: #06C755;
            --c-alert: #C53030;
            --theme-dark-bg: #1A202C;
            --font-serif: 'Noto Serif TC', serif; 
            --font-sans: 'Noto Sans TC', sans-serif; 
        }

        *, *::before, *::after { box-sizing: border-box; }
        
        body {
            margin: 0; font-family: var(--font-sans); background-color: var(--c-bg-body); color: var(--c-primary);
            line-height: 1.8; display: flex; flex-direction: column; min-height: 100vh; overflow-x: hidden;
        }

        /* Navbar & UI Styles (ä¿æŒåŸæ¨£ï¼Œçœç•¥éƒ¨åˆ†ç´°ç¯€ä»¥ç¯€çœç¯‡å¹…) */
        .navbar { background: rgba(26, 32, 44, 0.95); backdrop-filter: blur(10px); height: 70px; width: 100%; position: fixed; top: 0; left: 0; z-index: 9999; border-bottom: 1px solid rgba(197, 160, 101, 0.3); }
        .nav-container { display: flex; justify-content: space-between; align-items: center; height: 100%; max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .nav-logo { color: var(--c-accent); font-family: var(--font-serif); font-size: 1.5rem; font-weight: 700; }
        /* ... (Navbar CSS çœç•¥ï¼Œä¿æŒæ‚¨åŸæœ¬çš„è¨­å®šå³å¯) ... */
        
        /* è¡¨å–®å€åŸŸå„ªåŒ– */
        .container { width: 90%; max-width: 900px; margin: 0 auto; padding: 80px 0; flex: 1; }
        #capture-area { background-color: #fff; padding: 40px; border: 1px solid #E2E8F0; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border-top: 5px solid var(--c-accent); }
        
        /* è¼¸å…¥æ¡†æ¨£å¼ */
        .form-input, .date-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; margin-bottom: 15px; }
        .booking-info-wrapper { background-color: #FFFBF2; padding: 25px; border-radius: 8px; margin-bottom: 30px; border: 1px dashed var(--c-accent); }
        
        /* ç°½åæ¿ */
        .signature-wrapper { margin: 30px 0; padding: 20px; background: #EDF2F7; border-radius: 12px; text-align: center; }
        .sign-box { width: 100%; max-width: 500px; height: 250px; background: #fff; border: 2px solid #4A5568; margin: 10px auto; position: relative; touch-action: none; border-radius: 4px; }
        canvas { display: block; width: 100%; height: 100%; }
        
        /* æŒ‰éˆ•å€åŸŸ */
        .action-area { margin-top: 40px; text-align: center; padding-bottom: 40px; }
        .btn-submit { 
            background: var(--c-line); color: white; border: none; padding: 16px 40px; 
            font-size: 1.1rem; font-weight: bold; border-radius: 50px; cursor: pointer; 
            box-shadow: 0 4px 15px rgba(6, 199, 85, 0.3); transition: 0.3s; width: 100%; max-width: 350px;
            display: inline-flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-submit:hover { background-color: #05b64d; transform: translateY(-2px); }
        .btn-submit:disabled { background-color: #ccc; cursor: not-allowed; box-shadow: none; transform: none; }
        
        .loading-spinner { display: none; }
        .generating .loading-spinner { display: inline-block; animation: fa-spin 1s infinite linear; }

        /* éŒ¯èª¤æç¤º */
        .highlight-error { animation: shake 0.5s; border-color: #e53e3e !important; box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.2); }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* åˆç´„é¸é … */
        .contract-option { padding: 15px; margin-bottom: 15px; border-radius: 8px; font-size: 0.9rem; }
        .contract-option.selected { border: 2px solid var(--c-accent); background: #FFFCF5; position: relative; }
        .contract-option.selected::before { content: "â˜‘ é©ç”¨æ¢æ¬¾"; font-weight: bold; color: var(--c-accent); display: block; margin-bottom: 5px; }
        .contract-option.disabled { background: #f7fafc; color: #a0aec0; border: 1px dashed #cbd5e0; }

        /* Footer (ä¿æŒæ‚¨çš„æ¨£å¼) */
        .footer { background-color: var(--theme-dark-bg); color: #aaa; padding: 60px 0 30px; margin-top: auto; }
        /* ... å…¶ä»–æ¨£å¼çœç•¥ ... */
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">ä½ å¥½å“‡å¯“æ‰€</a>
            <div class="menu-toggle" id="mobile-menu"><span class="bar"></span><span class="bar"></span><span class="bar"></span></div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="index.html" class="nav-link">é¦–é </a></li>
                <li class="nav-item"><a href="rooms.html" class="nav-link">æˆ¿å‹</a></li>
                <li class="nav-item"><a href="agreement.html" class="nav-link active">å…¥ä½å¥‘ç´„</a></li>
            </ul>
        </div>
    </nav>

    <header class="hero">
        <div class="hero-bg"></div>
        <div class="hero-content">
            <h1>å…¥ä½å¥‘ç´„ç°½ç½²</h1>
            <p>ONLINE SIGNATURE</p>
        </div>
    </header>

    <div class="container">
        
        <div id="capture-area">
            <div style="text-align: center; margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 20px;">
                <h2 style="margin:0; color:#1A202C;">ä½å®¿å¥‘ç´„èˆ‡è¦ç¯„</h2>
                <p style="margin:5px 0 0; color:#C5A065; font-size:0.9rem;">Accommodation Contract</p>
            </div>

            <div id="booking-info" class="booking-info-wrapper">
                <div style="text-align:center; margin-bottom:20px;">
                    <label style="display:block; margin-bottom:8px; font-weight:bold; color:#C5A065;">å…¥ä½æœŸé–“ (Check-in / out)</label>
                    <input type="text" id="date-range-picker" class="date-input" placeholder="è«‹é¸æ“‡å…¥ä½èˆ‡é€€æˆ¿æ—¥æœŸ" readonly style="text-align:center;">
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <label style="font-size:0.9rem; font-weight:bold;">è¨‚æˆ¿äººå§“å (Name)</label>
                        <input type="text" id="booker-name" class="form-input" placeholder="çœŸå¯¦å§“å">
                    </div>
                    <div>
                        <label style="font-size:0.9rem; font-weight:bold;">è¯çµ¡é›»è©± (Phone)</label>
                        <input type="tel" id="booker-phone" class="form-input" placeholder="09xxxxxxxx">
                    </div>
                </div>
                
                <div style="margin-top: 15px;">
                    <label style="font-size:0.9rem; font-weight:bold;">å…¥ä½é¤¨åˆ¥</label>
                    <select id="house-select" class="form-input">
                        <option value="ä½ å¥½å“‡å¯“æ‰€">ä½ å¥½å“‡å¯“æ‰€ (ä¸»é¤¨)</option>
                        <option value="æºé ‚æ°‘å®¿">æºé ‚æ°‘å®¿ (äºŒé¤¨)</option>
                    </select>
                </div>
            </div>

            <div style="margin-bottom: 30px;">
                <div class="contract-option selected">
                    <strong>â–¡ ä¸€å¹´å…§ä¿ç•™å·²ä»˜é‡‘é¡ä½œç‚ºæ—¥å¾Œæ¶ˆè²»æŠ˜æŠµä½¿ç”¨ï¼š</strong>
                    <div style="margin-top:5px; font-size:0.85rem; color:#555;">
                        æ—…å®¢è§£ç´„é€šçŸ¥æ–¼é å®šä½å®¿æ—¥ç•¶æ—¥å‰åˆ°é”è€…ï¼Œå¾—æ–¼ä¸€å¹´å…§ä¿ç•™å·²ä»˜é‡‘é¡ä½œç‚ºæ—¥å¾Œæ¶ˆè²»æŠ˜æŠµä½¿ç”¨ã€‚é›™æ–¹åˆæ„ä¾æ­¤æ¢æ¬¾ä½œç‚ºè§£ç´„è™•ç†æ–¹å¼ã€‚
                    </div>
                </div>
            </div>

            <div style="margin-bottom: 30px; font-size: 0.9rem; line-height: 1.6; color:#444;">
                <h4 style="border-left: 3px solid #C5A065; padding-left: 10px; margin-bottom: 10px;">é‡é»è¦ç¯„ç¢ºèª</h4>
                <ul style="padding-left: 20px;">
                    <li><strong>æŠ¼é‡‘è¦å®šï¼š</strong>å…¥ä½æ”¶å–æŠ¼é‡‘ $5,000ï¼Œé€€æˆ¿ç¢ºèªç„¡æå£ä¸”ç„¡é•è¦å¾Œå…¨é¡é€€é‚„ã€‚</li>
                    <li><strong>ç¦æ­¢è¡Œç‚ºï¼š</strong>å®¤å…§å…¨é¢ç¦è¸ã€ç¦æ¯’ã€ç¦è³­ï¼Œä¸”åš´ç¦æ”œå¸¶å¯µç‰© (é™¤éäº‹å‰ç²å‡†)ã€‚</li>
                    <li><strong>å®‰å¯§æ™‚é–“ï¼š</strong>æ¯æ—¥ 23:00 è‡³éš”æ—¥ 08:00 è«‹é™ä½éŸ³é‡ï¼Œå‹¿å–§å˜©ã€‚</li>
                    <li><strong>è³ å„Ÿè²¬ä»»ï¼š</strong>è‹¥é€ æˆè¨­å‚™æå£æˆ–é«’äº‚ç„¡æ³•æ¸…æ½”ï¼Œå°‡ç…§åƒ¹è³ å„Ÿæˆ–æ”¶å–æ¸…æ½”è²»ã€‚</li>
                </ul>
            </div>

            <div class="signature-wrapper" id="signature-wrapper">
                <div style="font-weight:bold; margin-bottom:5px;">æ—…å®¢ç°½å (Signature)</div>
                <div style="font-size:0.8rem; color:#666;">æœ¬äººå·²è©³é–±ä¸¦åŒæ„ä¸Šè¿°æ‰€æœ‰æ¢æ¬¾</div>
                
                <div class="sign-box" id="sign-wrapper">
                    <span id="sign-hint" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:#ccc; font-size:1.5rem; pointer-events:none;">è«‹åœ¨æ­¤ç°½å</span>
                    <canvas id="signature-canvas"></canvas>
                </div>
                
                <button onclick="clearPad()" style="background:none; border:none; color:#718096; cursor:pointer; font-size:0.9rem; margin-top:5px;">
                    <i class="fa-solid fa-rotate-right"></i> æ¸…é™¤é‡ç°½
                </button>
                <div id="date-display" style="margin-top:10px; font-family:monospace; font-weight:bold;"></div>
            </div>
        </div>

        <div class="action-area">
            <button id="btn-submit" class="btn-submit" onclick="submitContract()">
                <span class="btn-text">âœ… ç¢ºèªç°½ç½²ä¸¦å›å‚³</span>
                <i class="fa-solid fa-spinner loading-spinner"></i>
            </button>
            <p style="font-size:13px; color:#666; margin-top:15px;">ç³»çµ±å°‡è‡ªå‹•ç”Ÿæˆ PDF ä¸¦åŠ å¯†ä¸Šå‚³è‡³ç®¡å®¶é›²ç«¯</p>
        </div>

    </div>

    <footer class="footer">
        <div style="text-align:center; font-size:0.85rem;">Â© 2025 ä½ å¥½å“‡å¯“æ‰€ Hello House.</div>
    </footer>

    <script>
        // â˜…â˜…â˜… è«‹è¨­å®šæ‚¨çš„ GAS ç¶²å€ èˆ‡ LIFF ID â˜…â˜…â˜…
        const GAS_APP_URL = "https://script.google.com/macros/s/AKfycbzfqpbILo5s6P0593PcdpYVie5cbyYGhxe83-Xbzs5QHymN6uNwo37ziT0As6zj1tZk1w/exec";
        const MY_LIFF_ID = "2008582194-vLLGoM4M"; 

        // åˆå§‹åŒ–
        const { jsPDF } = window.jspdf;
        let datePicker;

        document.addEventListener('DOMContentLoaded', function() {
            // 1. åˆå§‹åŒ– LIFF
            if (typeof liff !== 'undefined') {
                liff.init({ liffId: MY_LIFF_ID }).catch(err => console.error(err));
            }

            // 2. æ—¥æœŸé¸æ“‡å™¨
            datePicker = flatpickr("#date-range-picker", {
                mode: "range",
                minDate: "today",
                dateFormat: "Y-m-d",
                conjunction: " è‡³ ",
                locale: "zh_tw"
            });

            // 3. ç°½åæ¿åˆå§‹åŒ–
            initSignaturePad();
        });

        // ç°½åæ¿é‚è¼¯
        const canvas = document.getElementById('signature-canvas');
        const ctx = canvas.getContext('2d');
        const hint = document.getElementById('sign-hint');
        let hasSigned = false;

        function initSignaturePad() {
            const wrapper = document.getElementById('sign-wrapper');
            
            function resize() {
                const ratio = Math.max(window.devicePixelRatio || 1, 1);
                canvas.width = wrapper.offsetWidth * ratio;
                canvas.height = wrapper.offsetHeight * ratio;
                ctx.scale(ratio, ratio);
                ctx.lineWidth = 2; ctx.lineCap = "round"; ctx.strokeStyle = "#000";
            }
            window.addEventListener('resize', resize);
            resize();

            let isDrawing = false;
            
            const start = (e) => { isDrawing = true; hasSigned = true; hint.style.display = 'none'; ctx.beginPath(); draw(e); };
            const end = () => { isDrawing = false; ctx.beginPath(); };
            const draw = (e) => {
                if(!isDrawing) return;
                const rect = canvas.getBoundingClientRect();
                let x, y;
                if(e.type.includes('touch')) {
                    x = e.touches[0].clientX - rect.left;
                    y = e.touches[0].clientY - rect.top;
                } else {
                    x = e.clientX - rect.left;
                    y = e.clientY - rect.top;
                }
                ctx.lineTo(x, y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(x, y);
            };

            canvas.addEventListener('mousedown', start);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', end);
            canvas.addEventListener('touchstart', start, {passive: false});
            canvas.addEventListener('touchmove', draw, {passive: false});
            canvas.addEventListener('touchend', end);
        }

        function clearPad() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            hint.style.display = 'block';
            hasSigned = false;
        }

        // â˜…â˜…â˜… æ ¸å¿ƒåŠŸèƒ½ï¼šç”Ÿæˆ PDF ä¸¦ä¸Šå‚³ â˜…â˜…â˜…
        // â˜…â˜…â˜… è¼•é‡åŒ–ç©©å®šç‰ˆï¼šç”Ÿæˆ PDF ä¸¦ä¸Šå‚³ â˜…â˜…â˜…
        async function submitContract() {
            const name = document.getElementById('booker-name').value.trim();
            const phone = document.getElementById('booker-phone').value.trim();
            const house = document.getElementById('house-select').value;
            const phoneRegex = /^09\d{8}$/;

            // 1. é©—è­‰
            if (!datePicker || datePicker.selectedDates.length !== 2) return alertAndFocus("è«‹é¸æ“‡ã€Œå…¥ä½èˆ‡é€€æˆ¿æ—¥æœŸã€", "date-range-picker");
            if (!name) return alertAndFocus("è«‹è¼¸å…¥è¨‚æˆ¿äººå§“å", "booker-name");
            if (!phoneRegex.test(phone)) return alertAndFocus("è«‹è¼¸å…¥æ­£ç¢ºçš„æ‰‹æ©Ÿè™Ÿç¢¼ (09xxxxxxxx)", "booker-phone");
            if (!hasSigned) return alertAndFocus("è«‹åœ¨ä¸‹æ–¹ç°½åæ¬„å®Œæˆç°½å", "signature-canvas");

            // 2. æ›´æ–°æ™‚é–“èˆ‡é–å®š
            const now = new Date();
            document.getElementById('date-display').innerText = "ç°½ç½²æ™‚é–“ï¼š" + now.toLocaleString('zh-TW');
            
            const btn = document.getElementById('btn-submit');
            const btnText = btn.querySelector('.btn-text');
            btn.disabled = true;
            btn.classList.add('generating');
            btnText.innerText = "æ­£åœ¨å£“ç¸®ä¸¦ä¸Šå‚³ PDF..."; // æç¤ºæ–‡å­—æ”¹ä¸€ä¸‹

            try {
                const checkInDate = document.getElementById('date-range-picker').value.split(' è‡³ ')[0].replace(/-/g, '');
                const fileName = `${checkInDate}_${house}_${name}_${phone}.pdf`;

                // 3. â˜…â˜…â˜… é—œéµä¿®æ”¹ï¼šé™ä½è§£æåº¦ä»¥ç¢ºä¿ä¸Šå‚³æˆåŠŸ â˜…â˜…â˜…
                const captureArea = document.getElementById("capture-area");
                
                // scale: 1 (åŸå°ºå¯¸å³å¯ï¼Œæ‰‹æ©Ÿè¢å¹•å…¶å¯¦å¤ æ¸…æ¥š)
                const canvasData = await html2canvas(captureArea, { 
                    scale: 1, 
                    useCORS: true, 
                    backgroundColor: "#ffffff" 
                });
                
                // åœ–ç‰‡å£“ç¸®å“è³ªæ”¹ç‚º 0.6 (å¤§å¹…ç¸®å°æª”æ¡ˆé«”ç©)
                const imgData = canvasData.toDataURL('image/jpeg', 0.6);
                
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const imgProps = pdf.getImageProperties(imgData);
                const imgHeight = (imgProps.height * pdfWidth) / imgProps.width;
                
                if (imgHeight > pdf.internal.pageSize.getHeight()) {
                    const longPdf = new jsPDF('p', 'mm', [pdfWidth, imgHeight + 10]);
                    longPdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, imgHeight);
                    var pdfBase64 = longPdf.output('datauristring');
                } else {
                    pdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, imgHeight);
                    var pdfBase64 = pdf.output('datauristring');
                }

                // 4. ä¸Šå‚³åˆ° GAS (å¢åŠ  redirect åƒæ•¸)
                const response = await fetch(GAS_APP_URL, {
                    method: "POST",
                    redirect: "follow", // ç¢ºä¿è·Ÿéš¨ GAS çš„è½‰å€
                    body: JSON.stringify({
                        type: "UPLOAD_IMG",
                        image: pdfBase64,
                        filename: fileName,
                        user: name
                    }),
                    // é¿å…ç™¼é€é¡å¤–çš„ Preflight è«‹æ±‚
                    headers: { "Content-Type": "text/plain;charset=utf-8" }
                });
                
                // â˜…â˜…â˜… éŒ¯èª¤åµéŒ¯ï¼šå¦‚æœå›å‚³ä¸æ˜¯ JSONï¼Œæ‹‹å‡ºæ–‡å­—å…§å®¹ä»¥ä¾¿é™¤éŒ¯ â˜…â˜…â˜…
                const textResponse = await response.text();
                let result;
                try {
                    result = JSON.parse(textResponse);
                } catch (e) {
                    throw new Error("GAS å›å‚³éŒ¯èª¤ (é JSON): " + textResponse.substring(0, 100));
                }

                if (result.status === "success") {
                    const downloadLink = result.url;
                    if (liff.isInClient()) {
                        await liff.sendMessages([
                            {
                                type: "flex",
                                altText: "ğŸ“„ æ‚¨æœ‰ä¸€ä»½ç°½ç½²å®Œæˆçš„åˆç´„",
                                contents: {
                                    "type": "bubble",
                                    "size": "mega",
                                    "body": {
                                        "type": "box",
                                        "layout": "vertical",
                                        "contents": [
                                            { "type": "text", "text": "âœ… ç·šä¸Šç°½ç½²å®Œæˆ", "weight": "bold", "color": "#1DB446", "size": "sm" },
                                            { "type": "text", "text": "ä½å®¿å¥‘ç´„æ›¸", "weight": "bold", "size": "xl", "margin": "md" },
                                            { "type": "text", "text": fileName, "size": "xxs", "color": "#aaaaaa", "wrap": true, "margin": "xs" },
                                            { "type": "separator", "margin": "lg" },
                                            {
                                                "type": "box", "layout": "vertical", "margin": "lg", "spacing": "sm",
                                                "contents": [
                                                    { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "ç°½ç½²äºº", "color": "#aaaaaa", "size": "sm", "flex": 2 }, { "type": "text", "text": name, "wrap": true, "color": "#666666", "size": "sm", "flex": 5 } ] },
                                                    { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "é¤¨åˆ¥", "color": "#aaaaaa", "size": "sm", "flex": 2 }, { "type": "text", "text": house, "wrap": true, "color": "#666666", "size": "sm", "flex": 5 } ] }
                                                ]
                                            }
                                        ]
                                    },
                                    "footer": {
                                        "type": "box", "layout": "vertical", "spacing": "sm",
                                        "contents": [
                                            { "type": "button", "style": "primary", "height": "sm", "color": "#C5A065", "action": { "type": "uri", "label": "ğŸ“¥ ä¸‹è¼‰/æŸ¥çœ‹åˆç´„ PDF", "uri": downloadLink } },
                                            { "type": "text", "text": "æ­¤é€£çµç”± Google Drive æä¾›ï¼Œæ°¸ä¹…æœ‰æ•ˆã€‚", "size": "xxs", "color": "#bbbbbb", "align": "center", "margin": "sm" }
                                        ]
                                    }
                                }
                            }
                        ]);
                        liff.closeWindow();
                    } else {
                        alert("âœ… ç°½ç´„æˆåŠŸï¼\næª”æ¡ˆå·²ä¸Šå‚³è‡³é›²ç«¯ï¼Œè«‹é»æ“Šç¢ºå®šè·³è½‰å› LINEã€‚");
                        window.location.href = LINE_DEEP_LINK;
                    }
                } else {
                    throw new Error(result.msg || "Unknown GAS error");
                }

            } catch (err) {
                console.error(err);
                // é€™è£¡æœƒæŠŠå…·é«”çš„éŒ¯èª¤é¡¯ç¤ºå‡ºä¾†
                alert("ä¸Šå‚³å¤±æ•—ï¼\nåŸå› ï¼š" + err.message);
                btn.disabled = false;
                btn.classList.remove('generating');
                btnText.innerText = "âœ… ç¢ºèªç°½ç½²ä¸¦å›å‚³";
            }
        }

        function alertAndFocus(msg, id) {
            alert(msg);
            const el = document.getElementById(id);
            el.scrollIntoView({behavior: "smooth", block: "center"});
            el.classList.add('highlight-error');
            setTimeout(() => el.classList.remove('highlight-error'), 1500);
        }

        function alertAndFocus(msg, id) {
            alert(msg);
            const el = document.getElementById(id);
            el.scrollIntoView({behavior: "smooth", block: "center"});
            el.classList.add('highlight-error');
            setTimeout(() => el.classList.remove('highlight-error'), 1500);
        }
    </script>
</body>
</html>